# MixEditor
## 概念
### 区域
区域是 MixEditor 中用于表示内容的基本单位，包含块区和行内区两种类型。

#### 块区
块区用于表达一个块级元素，通常是个矩形。

常见的块区有：
* 段落：没有特殊样式的矩形区域。
* 标题：通常用于表示段落中的标题，通常会相对显眼。
* 列表：通常用于表示一组内容，分为有序列表和无序列表两种。
* 引用：通常用于表示一段引用内容。
* 代码块：通常用于表示一段代码内容。
* 多媒体：通常用于表示一段多媒体内容，例如图片、视频、音频等。
* 分割线：通常用于表示一段分割线内容。

#### 行内区
行内区用于表达一个行内元素，通常被包含在块区中。

常见的行内区有：
* 文本：通常用于表示一段文本内容。
* 图片：通常用于表示一张图片。

#### 行内区标签
行内区标签用于为行内区添加修饰。

常见的行内区标签有：
* 超链接：通常用于表示一个超链接。
* 强调：通常用于表示强调内容。
* 删除：通常用于表示删除内容。
* 代码段：通常用于表示一段代码内容。
* 高亮：通常用于表示高亮内容。

#### 接口
区域具有以下接口：
* `get_child(index: number)`：获取区域指定索引的子区域。
* `get_child_position(index: number)`：获取区域相对于编辑器的位置。

## 功能设计
### 选区
选区是 MixEditor 中用于表示用户当前选中的内容。选区包含起始位置和结束位置，其都是一个数组，记录了光标在区块中的位置。

#### 光标
光标的渲染位置、渲染方式、移动模式完全由插件提供的渲染器支持。MixEditor 只是负责渲染器之间光标的协调调度。

##### 光标位置的计算
光标会从区域开始，按照光标记录的索引，调用 `get_child` 方法，访问其子区域，直到到达倒数第二个索引时，调用 `get_child_position` 方法，获取其相对于编辑器的位置。

##### 光标的移动
光标移动时，会根据移动方向，调用 `move_left` 或 `move_right` 方法，移动选区。

`move_left` 和 `move_right` 调用时，会根据移动方向，逐个 area 调用 `cursor_enter` 方法。`cursor_enter` 方法需可以选择直接接收，或者交给子元素处理。如果 `cursor_enter` 方法拒绝进入，则继续获取方向上的下一个子元素，直到找到一个接受进入的元素。

针对行内区域，我们使用无头有尾的约定：行内区域如果没有刻意的隔离设计，在尝试 `move_left` 的时候应该跳过头部，而是应该让 `move_left` 的行为继续，直达上一个区域的末尾；在尝试 `move_right` 如果到了头部，应该让 `move_right` 的行为继续，直达当前行内区域的第二个子项的位置。